# Main Hydra configuration for LDC solvers
# Usage: uv run python run_solver.py solver=fv Re=100 N=32
#        uv run python run_solver.py solver=spectral Re=100 N=15
#
# Parallel sweeps with joblib:
#   uv run python run_solver.py -m hydra/launcher=joblib solver=fv N=16,32,64 Re=100

defaults:
  - solver: fv
  - shared/mlflow@mlflow: local
  - _self_

# =============================================================================
# Common Parameters (shared by all solvers)
# =============================================================================

# Grid size (meaning depends on solver):
#   FV: N = number of cells in each direction
#   Spectral: N = polynomial order (gives N+1 nodes)
N: 32

# Physics
Re: 100
lid_velocity: 1.0
Lx: 1.0
Ly: 1.0

# Solver control
tolerance: 1.0e-6
max_iterations: 500
generate_plots: true

# Experiment tracking
experiment_name: LDC-Solver
sweep_name: sweep  # Name for parent run in multirun sweeps

# =============================================================================
# Hydra output paths and callbacks
# =============================================================================
hydra:
  run:
    dir: hydra_outputs/${experiment_name}/Re${Re}/${solver.name}/${now:%d-%m-%y}/${now:%H:%M:%S}
  sweep:
    dir: hydra_outputs/multirun/${experiment_name}/Re${Re}/${solver.name}/${now:%d-%m-%y}/${now:%H:%M:%S}
    subdir: N${N}
  callbacks:
    mlflow_sweep:
      _target_: utilities.mlflow.callback.MLflowSweepCallback
